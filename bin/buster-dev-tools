#!/usr/bin/env node
var dt = require("../lib/buster-dev-tools");
var projects = require("../project-list");

function error() {
    process.stderr.write("Unrecognized option(s) encountered. See --help.\n");
    process.exit(1);
}

var args = process.argv.slice(2);
if (args.length !== 1) return error();
var arg = args[0];

if (arg == "-h" || args == "--help") {
    console.log("buster-dev-tools");
    console.log();
    console.log("  install   Installs all the things.");
    console.log("   update   Updates all the things.");
    console.log("     deps   Reinstalls all non-buster deps.");
    console.log(" depgraph   Produces a graph of dependencies (requires dot from http://www.graphviz.org/Download..php ).");
    return;
}

if (args == "install") {
    dt.doOperations(projects, [dt.clone, dt.submodules, dt.installDeps]);
    return;
}

if (args == "update") {
    dt.doOperations(projects, [dt.pull, dt.submodules, dt.installDeps]);
    return;
}

if (args == "deps") {
    dt.doOperations(projects, [dt.installDeps]);
    return;
}

if (args.indexOf("depgraph") > -1) {
    dt.doOperations(projects, [dt.dependencyGraph.init, dt.dependencyGraph.build]);
    return;
}

process.stderr.write("Unrecognized option. See --help.");
process.exit(1);
error();